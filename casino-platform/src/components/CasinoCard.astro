---
export interface Props {
  data: any;
  index: number;
}

const { data, index } = Astro.props;
const {
  name,
  logo_url,
  rank,
  rating,
  welcome_bonus_headline,
  payout_speed,
  affiliate_url,
  banking,
  providers,
  license,
  min_deposit,
  vip_high_roller,
  mobile_app,
  customer_service
} = data;

// Rank Badge Logic
const getRankTier = (r) => {
  if (r === 1) return 'tier-gold';
  if (r === 2) return 'tier-silver';
  if (r === 3) return 'tier-bronze';
  return 'tier-muted';
};

// Star Logic
const fullStars = Math.floor(rating);
const hasHalf = rating % 1 >= 0.4;
const emptyStars = 5 - fullStars - (hasHalf ? 1 : 0);
---

<div class="casino-card" style={`animation-delay: ${index * 0.1}s`}>
  <div class="casino-row-main">
    
    <!-- 1. Rank & Name -->
    <div class="rank-name-wrapper">
      <div class="rank-col">
        <div class={`rank-box ${getRankTier(rank)}`}>{rank}</div>
      </div>
      <div class="casino-info-col">
        <img src={logo_url} alt={name} class="casino-logo" />
        <div class="name-rating-stack">
          <span class="casino-name">{name}</span>
          <div class="mobile-rating">
             <div class="stars">
              {Array(fullStars).fill(0).map(() => <i class="fa-solid fa-star"></i>)}
              {hasHalf && <i class="fa-solid fa-star-half-stroke"></i>}
            </div>
            <span class="mobile-rating-text">{rating}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 2. Bonus -->
    <div class="bonus-col">
      <span class="bonus-highlight" set:html={welcome_bonus_headline}></span>
      <span class="bonus-sub">New Player Offer</span>
    </div>

    <!-- 3. Rating (Desktop) -->
    <div class="rating-col">
      <div class="stars">
        {Array(fullStars).fill(0).map(() => <i class="fa-solid fa-star"></i>)}
        {hasHalf && <i class="fa-solid fa-star-half-stroke"></i>}
        {Array(emptyStars).fill(0).map(() => <i class="fa-regular fa-star"></i>)}
      </div>
      <span class="score-text">{rating}</span>
    </div>

    <!-- 4. Payments -->
    <div class="payment-col">
      {banking.slice(0, 4).map((m) => (
        <span class="pay-icon">{m.method}</span>
      ))}
    </div>

    <!-- 5. Actions -->
    <div class="action-col">
      <a href={affiliate_url} class="btn-play">Claim Now</a>
      <button class="toggle-details" onclick="this.closest('.casino-card').querySelector('.casino-details-panel').classList.toggle('active')">
        Details <i class="fa-solid fa-chevron-down"></i>
      </button>
    </div>
  </div>

  <!-- DETAILS PANEL -->
  <div class="casino-details-panel">
    <div class="detail-box">
      <span class="detail-title">Banking options</span>
      <div class="tag-list">
        {banking.map((m) => <span class="text-tag">{m.method}</span>)}
      </div>
    </div>

    <div class="detail-box">
      <span class="detail-title">Providers</span>
      <div class="tag-list">
        {providers && providers.map((p) => <span class="text-tag">{p.name}</span>)}
      </div>
    </div>

    <div class="detail-box">
      <span class="detail-title">Bonus Stats</span>
      <div class="bonus-row">
        <span class="bonus-label">Min Deposit</span>
        <span class="bonus-value">{min_deposit}</span>
      </div>
      <div class="bonus-row">
        <span class="bonus-label">Payout Speed</span>
        <span class="bonus-value">{payout_speed}</span>
      </div>
    </div>

    <div class="detail-box">
        <span class="detail-title">VIP Features</span>
        <div class="detail-content">{vip_high_roller ? "High Roller Program Available" : "-"}</div>
    </div>

    <div class="panel-footer">
      <div class="license-info">
        <i class="fa-solid fa-shield-halved"></i> Licensed by {license}
      </div>
      <span class="review-link">Read Review &rarr;</span>
    </div>
  </div>
</div>

<style>
  /* MATCHING STYLES FROM UPLOADED HTML */
  
  .casino-card {
    background-color: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 12px;
    overflow: hidden;
    opacity: 0;
    animation: fadeUp 0.6s ease-out forwards;
    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
  }

  .casino-card:hover {
    transform: translateY(-5px);
    border-color: #555;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    z-index: 2;
  }

  .casino-row-main {
    display: grid;
    /* 80px | 1.5fr | 2fr | 1fr | 1.2fr | 160px */
    grid-template-columns: 80px 1.5fr 2fr 1fr 1.2fr 160px;
    gap: 15px;
    align-items: center;
    padding: 15px 20px;
  }

  /* Rank Box */
  .rank-box {
    width: 42px; height: 42px;
    font-size: 1.05rem; font-weight: 900;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    transition: transform 0.3s ease;
  }
  .casino-card:hover .rank-box { transform: scale(1.1); }
  
  .tier-gold { background: linear-gradient(180deg, #FFF2B0 0%, #FFD700 50%, #C69C3A 100%); color: #1a1205; box-shadow: 0 10px 22px rgba(255, 215, 0, 0.45); }
  .tier-silver { background: linear-gradient(180deg, #F5F5F5 0%, #C9CCD1 100%); color: #1a1a1a; box-shadow: 0 6px 14px rgba(180, 180, 180, 0.35); }
  .tier-bronze { background: linear-gradient(180deg, #E2B07A 0%, #B87333 100%); color: #1a1205; box-shadow: 0 6px 14px rgba(184, 115, 51, 0.35); }
  .tier-muted { background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%); color: #999; box-shadow: inset 0 0 0 1px #333; }

  /* Info Col */
  .casino-info-col { display: flex; align-items: center; gap: 12px; }
  .casino-logo {
    width: 50px; height: 50px;
    border-radius: 50%;
    object-fit: contain;
    background: #111;
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .casino-card:hover .casino-logo { transform: rotate(360deg) scale(1.1); }
  
  .casino-name { font-weight: 700; font-size: 1.2rem; color: #fff; line-height: 1.2; }
  .mobile-rating { display: none; margin-top: 6px; align-items: center; gap: 8px; }

  /* Bonus */
  .bonus-col { display: flex; flex-direction: column; justify-content: center; }
  .bonus-highlight { color: var(--brand-gold); font-size: 1.1rem; font-weight: 700; }
  .bonus-sub { color: #fff; font-size: 0.85rem; }

  /* Rating */
  .rating-col { display: flex; align-items: center; justify-content: center; gap: 8px; }
  .stars { color: var(--brand-gold); font-size: 0.8rem; display: flex; gap: 2px; }
  .casino-card:hover .stars { animation: pulse 1s infinite; }
  .score-text { font-size: 0.9rem; font-weight: 700; color: #fff; }

  /* Payments */
  .payment-col { display: flex; flex-wrap: wrap; gap: 4px; justify-content: center; }
  .pay-icon { background: #fff; border-radius: 3px; padding: 2px 5px; color: #111; font-size: 0.7rem; font-weight: 700; }

  /* Actions */
  .action-col { display: flex; flex-direction: column; align-items: center; gap: 16px; }
  
  .btn-play {
    background: var(--cta-bg);
    color: #000;
    border: none;
    padding: 10px 16px;
    width: 100%;
    border-radius: 5px;
    font-weight: 900;
    font-size: 0.85rem;
    text-transform: uppercase;
    box-shadow: 0 4px 0px #b37400, 0 4px 12px var(--cta-shadow);
    position: relative;
    overflow: hidden;
    text-align: center;
    display: block;
  }
  
  .btn-play::after {
    content: '';
    position: absolute;
    top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  }
  .btn-play:hover { transform: translateY(-2px); box-shadow: 0 6px 0px #b37400, 0 8px 20px var(--cta-shadow); filter: brightness(1.1); }
  .btn-play:hover::after { animation: sheen 0.6s ease-in-out; }

  .toggle-details { background: none; border: none; color: #777; cursor: pointer; font-size: 0.75rem; }
  .toggle-details:hover { color: #fff; }

  /* Details Panel */
  .casino-details-panel {
    display: none;
    background-color: #0d0d0d;
    padding: 25px;
    border-top: 1px solid var(--border-color);
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    animation: fadeUp 0.4s ease-out;
  }
  .casino-details-panel.active { display: grid; }
  
  .detail-box {
    background: #181818;
    border: 1px solid #2a2a2a;
    border-radius: 12px;
    padding: 20px;
    display: flex; flex-direction: column; gap: 10px;
  }
  .detail-title { color: #fff; font-size: 0.95rem; font-weight: 700; margin-bottom: 5px; }
  .text-tag { background: #222; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; color: #ddd; border: 1px solid #333; display: inline-block; margin: 2px; }
  
  .bonus-row { display: flex; justify-content: space-between; border-bottom: 1px solid #2a2a2a; padding: 4px 0; font-size: 0.9rem; }
  .bonus-label { color: #888; }
  .bonus-value { color: #fff; font-weight: 600; }
  
  .panel-footer { grid-column: 1 / -1; display: flex; justify-content: space-between; border-top: 1px solid #2a2a2a; padding-top: 15px; color: #777; font-size: 0.8rem; }
  .review-link { color: #777; font-weight: 600; cursor: pointer; }
  .review-link:hover { color: var(--brand-gold); }

  /* Responsive */
  @media (max-width: 900px) {
    .casino-row-main {
      grid-template-columns: 1fr 1fr;
      grid-template-areas: 
        "header header"
        "bonus bonus"
        "payments payments"
        "action action";
    }
    .rank-name-wrapper { grid-area: header; display: grid; grid-template-columns: auto 1fr; gap: 15px; }
    .bonus-col { grid-area: bonus; text-align: center; background: #222; padding: 10px; border-radius: 6px; }
    .payment-col { grid-area: payments; }
    .action-col { grid-area: action; }
    .rating-col { display: none; }
    .mobile-rating { display: flex; }
    .casino-details-panel { grid-template-columns: 1fr; }
  }
</style>