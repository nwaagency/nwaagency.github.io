---
import Layout from "../../layouts/Layout.astro";
import CasinoCard from "../../components/CasinoCard.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
	const geos = ["de", "at", "ca", "nz", "ie", "global"];
	return geos.map((geo) => ({ params: { geo } }));
}

const { geo } = Astro.params;
const allCasinos = await getCollection("casinos");

// Filter Logic
const filteredCasinos = allCasinos.filter((casino) => {
	const data = casino.data;
	const core = data.core_identity || {};
	const rankVis = data.ranking_visibility || {};

	// Handle isActive (Nested or Root fallback)
	const isActive = core.isActive ?? data.isActive ?? true;
	if (!isActive) return false;

	// Handle Targeting (Nested Group)
	const allowed = rankVis.targeting_group || data.allowed_geos || ["global"];

	return allowed.includes("global") || allowed.includes(geo);
});

// Sorting Logic
const sortedCasinos = filteredCasinos.sort((a, b) => {
	const rankVisA = a.data.ranking_visibility || {};
	const rankVisB = b.data.ranking_visibility || {};
	const metricsA = a.data.ratings_metrics || {};
	const metricsB = b.data.ratings_metrics || {};

	const rankA = rankVisA.rank ?? a.data.rank ?? 999;
	const rankB = rankVisB.rank ?? b.data.rank ?? 999;

	// Primary: Rank
	if (rankA !== rankB) {
		return rankA - rankB;
	}

	// Secondary: Rating
	const ratingA = metricsA.rating ?? a.data.rating ?? 0;
	const ratingB = metricsB.rating ?? b.data.rating ?? 0;

	return ratingB - ratingA;
});

const geoNames: Record<string, string> = {
	de: "Germany",
	at: "Austria",
	ca: "Canada",
	nz: "New Zealand",
	ie: "Ireland",
	global: "World",
};
const countryName = geoNames[geo] || "Global";
const currentMonth = new Date().toLocaleString("default", { month: "long" });
const currentYear = new Date().getFullYear();
const pageTitle = `Best Online Casinos in ${countryName} - ${currentMonth} ${currentYear}`;
---

<Layout title={pageTitle}>
	<!-- 1. STICKY HEADER -->
	<header class="site-header" id="siteHeader">
		<div class="nav-bar">
			<div class="brand-logo">
				<i class="fa-solid fa-crown"></i> EXECUTIVE OFFERS <span>.VIP</span>
			</div>
			<nav class="nav-links">
				<a href="#">Home</a>
				<a href="#">Bonuses</a>
				<a href="#">Reviews</a>
			</nav>
			<a href="#" class="btn-contact">Contact Us</a>
		</div>
	</header>

	<!-- 2. HERO SECTION -->
	<section class="hero-section">
		<div class="hero-container">
			<span class="pre-title">Find the best online casinos</span>
			<h1 class="hero-title">Welcome to Your VIP Casino Advantage</h1>
			<p class="hero-subtitle">
				We rigorously test and review thousands of casinos to bring you the
				safest, most lucrative VIP offers available in {countryName} for 2025.
			</p>
			<div class="stats-grid">
				<div class="stat-card">
					<span class="stat-number">500+</span>
					<span class="stat-label">Exclusive Bonuses</span>
				</div>
				<div class="stat-card">
					<span class="stat-number">{sortedCasinos.length}</span>
					<span class="stat-label">Verified Casinos</span>
				</div>
				<div class="stat-card">
					<span class="stat-number">150+</span>
					<span class="stat-label">Active Players</span>
				</div>
				<div class="stat-card">
					<span class="stat-number">24/7</span>
					<span class="stat-label">Expert Support</span>
				</div>
			</div>
		</div>
	</section>

	<!-- 3. MAIN CONTENT -->
	<main class="main-content-area">
		<div class="casino-list-container">
			<!-- List -->
			<div class="casino-list">
				{
					sortedCasinos.map((casino, index) => (
						<CasinoCard data={casino.data} index={index + 1} />
					))
				}
			</div>

			{
				sortedCasinos.length === 0 && (
					<div style="text-align:center; padding: 40px; color: #666;">
						No casinos found for this region.
					</div>
				)
			}
		</div>
	</main>

	<!-- 4. NEWSLETTER -->
	<section class="newsletter-section">
		<div class="newsletter-container">
			<h2 class="newsletter-heading">Join the Winners Circle</h2>
			<p class="newsletter-sub">
				Get exclusive high-roller bonuses and VIP codes sent directly to your
				inbox weekly.
			</p>
			<form class="newsletter-form" onsubmit="event.preventDefault();">
				<input
					type="email"
					placeholder="Enter your email address"
					class="newsletter-input"
					required
				/>
				<button type="submit" class="newsletter-btn">Get VIP Access</button>
			</form>
		</div>
	</section>

	<!-- 5. FOOTER -->
	<footer class="site-footer">
		<div class="footer-grid">
			<div class="footer-col footer-brand">
				<div class="brand-logo" style="color: var(--brand-gold);">
					<i class="fa-solid fa-crown"></i> EXECUTIVE OFFERS
				</div>
				<p>
					The world's premier destination for exclusive casino bonuses and
					unbiased reviews. We help you play smarter and win bigger.
				</p>
				<div class="social-icons">
					<a href="#"><i class="fa-brands fa-twitter"></i></a>
					<a href="#"><i class="fa-brands fa-facebook-f"></i></a>
					<a href="#"><i class="fa-brands fa-instagram"></i></a>
					<a href="#"><i class="fa-brands fa-telegram"></i></a>
				</div>
			</div>
			<div class="footer-col">
				<h4>Quick Links</h4>
				<ul class="footer-links-list">
					<li><a href="#">Top Rated Casinos</a></li>
					<li><a href="#">Newest Bonuses</a></li>
					<li><a href="#">No Deposit Offers</a></li>
					<li><a href="#">Crypto Casinos</a></li>
					<li><a href="#">Casino Reviews</a></li>
				</ul>
			</div>
			<div class="footer-col">
				<h4>Support</h4>
				<ul class="footer-links-list">
					<li><a href="#">Contact Us</a></li>
					<li><a href="#">About Us</a></li>
					<li><a href="#">Editorial Guidelines</a></li>
					<li><a href="#">Responsible Gambling</a></li>
					<li><a href="#">Sitemap</a></li>
				</ul>
			</div>
			<div class="footer-col">
				<h4>Legal</h4>
				<ul class="footer-links-list">
					<li><a href="#">Privacy Policy</a></li>
					<li><a href="#">Terms & Conditions</a></li>
					<li><a href="#">Cookie Policy</a></li>
					<li><a href="#">Disclaimer</a></li>
				</ul>
			</div>
		</div>
		<div class="footer-bottom-bar">
			<div class="copyright-text">
				&copy; 2025 EXECUTIVE Offers VIP. All rights reserved. 18+ Please gamble
				responsibly.
			</div>
			<div class="footer-bottom-links">
				<i class="fa-solid fa-shield-halved"></i> SSL Secure Connection
			</div>
		</div>
	</footer>
</Layout>

<style>
	/* Reuse styles from index (1).html provided earlier in chat */
	.site-header {
		background-color: #000;
		border-bottom: 1px solid #222;
		position: sticky;
		top: 0;
		z-index: 1000;
		width: 100%;
		transition:
			background-color 0.4s ease,
			backdrop-filter 0.4s ease,
			padding 0.4s ease,
			box-shadow 0.4s ease;
	}
	.site-header.scrolled {
		background-color: rgba(0, 0, 0, 0.85);
		backdrop-filter: blur(12px);
		border-bottom: 1px solid rgba(255, 255, 255, 0.08);
		box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
		padding-top: 5px;
		padding-bottom: 5px;
	}
	.nav-bar {
		display: flex;
		justify-content: space-between;
		align-items: center;
		max-width: 1200px;
		margin: 0 auto;
		padding: 15px 20px;
	}
	.brand-logo {
		display: flex;
		flex-direction: column;
		align-items: center;
		color: var(--brand-gold);
		text-transform: uppercase;
		font-weight: 800;
		font-size: 1.1rem;
		letter-spacing: 1px;
		line-height: 1;
		transform: scale(1);
	}
	.brand-logo:hover {
		transform: scale(1.05);
		text-shadow: 0 0 15px rgba(198, 156, 58, 0.6);
	}
	.brand-logo i {
		font-size: 1.6rem;
		margin-bottom: 4px;
	}
	.brand-logo span {
		font-size: 0.75rem;
		color: #fff;
		letter-spacing: 2px;
	}

	.nav-links {
		display: flex;
		gap: 30px;
	}
	.nav-links a {
		font-size: 0.9rem;
		font-weight: 600;
		color: #ccc;
		text-transform: uppercase;
		position: relative;
	}
	.nav-links a:hover {
		color: var(--brand-gold);
		transform: translateY(-2px);
	}
	.nav-links a::after {
		content: "";
		position: absolute;
		width: 0;
		height: 2px;
		bottom: -4px;
		left: 0;
		background-color: var(--brand-gold);
		transition: width 0.3s ease;
	}
	.nav-links a:hover::after {
		width: 100%;
	}

	.btn-contact {
		background-color: var(--brand-gold);
		color: #1a1106;
		padding: 8px 24px;
		border-radius: 4px;
		font-weight: 700;
		font-size: 0.85rem;
	}
	.btn-contact:hover {
		background-color: var(--brand-gold-bright);
		box-shadow: 0 0 15px rgba(198, 156, 58, 0.4);
		transform: translateY(-2px);
	}

	.hero-section {
		background: linear-gradient(180deg, #1a1a1a 0%, #121212 100%);
		padding: 50px 20px;
		text-align: center;
		border-bottom: 1px solid var(--border-color);
		animation: fadeUp 0.8s ease-out forwards;
	}
	.hero-container {
		max-width: 1000px;
		margin: 0 auto;
	}
	.pre-title {
		color: var(--brand-gold);
		font-size: 0.85rem;
		text-transform: uppercase;
		letter-spacing: 1px;
		display: block;
		margin-bottom: 10px;
	}
	.hero-title {
		font-size: 2.2rem;
		color: #fff;
		margin-bottom: 20px;
		font-weight: 700;
	}
	.hero-subtitle {
		color: #999;
		max-width: 600px;
		margin: 0 auto 40px;
		line-height: 1.6;
	}

	.stats-grid {
		display: grid;
		grid-template-columns: repeat(4, 1fr);
		gap: 20px;
		margin-top: 30px;
	}
	.stat-card {
		background: #fff;
		color: #111;
		padding: 20px;
		border-radius: 8px;
		text-align: center;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
	}
	.stat-card:hover {
		transform: translateY(-5px);
		box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
	}
	.stat-number {
		display: block;
		font-size: 1.4rem;
		font-weight: 800;
		color: #6a1b9a;
		margin-bottom: 5px;
	}
	.stat-label {
		font-size: 0.8rem;
		color: #555;
		font-weight: 600;
		text-transform: uppercase;
	}

	.main-content-area {
		padding: 40px 20px;
		flex: 1;
	}
	.casino-list-container {
		max-width: 1200px;
		margin: 0 auto;
	}
	.table-header {
		display: grid;
		grid-template-columns: 80px 1.5fr 2fr 1fr 1.2fr 160px;
		gap: 15px;
		padding: 15px 20px;
		font-size: 0.75rem;
		font-weight: 700;
		text-transform: uppercase;
		color: #555;
		border-bottom: 1px solid var(--border-color);
		margin-bottom: 10px;
	}

	.newsletter-section {
		background: linear-gradient(135deg, #ffc107 0%, #ffd700 50%, #ffb300 100%);
		padding: 60px 20px;
		text-align: center;
		margin-top: 50px;
		color: #1a1a1a;
		border-top: 4px solid #b38600;
		box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
		animation: fadeUp 0.8s ease-out forwards;
		animation-delay: 0.4s;
	}
	.newsletter-heading {
		font-size: 1.8rem;
		font-weight: 800;
		margin-bottom: 10px;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}
	.newsletter-sub {
		margin-bottom: 35px;
		font-size: 1rem;
		color: #222;
		font-weight: 500;
	}
	.newsletter-form {
		display: flex;
		justify-content: center;
		gap: 15px;
		flex-wrap: wrap;
	}
	.newsletter-input {
		padding: 14px 25px;
		border: 2px solid #000;
		border-radius: 6px;
		width: 350px;
	}
	.newsletter-btn {
		background-color: #d32f2f;
		color: #fff;
		border: none;
		padding: 14px 35px;
		border-radius: 6px;
		font-weight: 800;
		cursor: pointer;
		text-transform: uppercase;
	}
	.newsletter-btn:hover {
		background-color: #b71c1c;
		transform: translateY(-2px);
		box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
	}

	.site-footer {
		background-color: #080808;
		color: #999;
		padding: 60px 20px 20px;
		animation: fadeUp 0.8s ease-out forwards;
		animation-delay: 0.5s;
	}
	.footer-grid {
		max-width: 1200px;
		margin: 0 auto 50px;
		display: grid;
		grid-template-columns: 1.5fr 1fr 1fr 1fr;
		gap: 40px;
	}
	.footer-col h4 {
		color: #fff;
		font-size: 1rem;
		font-weight: 700;
		margin-bottom: 20px;
		text-transform: uppercase;
		border-left: 3px solid var(--brand-gold);
		padding-left: 10px;
	}
	.footer-links-list li {
		margin-bottom: 12px;
	}
	.footer-links-list a:hover {
		color: var(--brand-gold);
		padding-left: 5px;
	}
	.social-icons {
		display: flex;
		gap: 15px;
		margin-top: 10px;
	}
	.social-icons a {
		width: 36px;
		height: 36px;
		background: #222;
		color: #fff;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: 0.3s;
	}
	.social-icons a:hover {
		background: var(--brand-gold);
		color: #000;
	}
	.footer-bottom-bar {
		max-width: 1200px;
		margin: 0 auto;
		padding-top: 25px;
		border-top: 1px solid #222;
		display: flex;
		justify-content: space-between;
		font-size: 0.8rem;
	}

	@media (max-width: 900px) {
		.nav-links,
		.table-header {
			display: none;
		}
		.stats-grid {
			grid-template-columns: 1fr 1fr;
		}
		.footer-grid {
			grid-template-columns: 1fr;
			gap: 30px;
		}
		.newsletter-input,
		.newsletter-btn {
			width: 100%;
		}
		.footer-bottom-bar {
			flex-direction: column;
			gap: 10px;
			text-align: center;
		}
	}
</style>
